<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopify Metafields</title>
    <script src="https://unpkg.com/alpinejs" defer></script>
    <script src="https://cdn.tailwindcss.com/"></script>
</head>
<body x-data="meta" class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-screen-lg mx-auto p-8 md:p-32">
    <h1 class="col-span-full text-2xl font-bold">Shopify Bulk Metafield Generator</h1>
    <section>
        <h2 class="text-xl font-bold">Inputs</h2>
        <form class="grid grid-cols-1 gap-4 mt-8">
            <div>
                <label for="shop" class="block">Shop URL</label>
                <input type="text" name="shop" id="shop" x-model="shop" class="border w-full p-2" placeholder="example.myshopify.com">
            </div>
            <div>
                <label for="resource" class="block">Resource type</label>
                <select name="resource" id="resource" x-model="resource" class="border p-2">
                    <option value="Product">Product</option>
                    <option value="Collection">Collection</option>
                    <option value="Article">Article</option>
                </select>
            </div>
            <ul class="space-y-4">
                <template x-for="(field, index) in fields">
                    <li>
                        <fieldset class="grid grid-cols-1 gap-2 border p-2">
                            <legend>Field <span x-text="index + 1 + ': '"></span></legend>
                            <div>
                                <label :for="'namespace_' + index + 1" class="block">Namespace</label>
                                <input type="text" :name="'namespace_' + index + 1" :id="'namespace_' + index + 1" x-model="fields[index].namespace" class="border p-2"></span>
                            </div>
                            <div>
                                <label :for="'key_' + index + 1" class="block">Key</label>
                                <input type="text" :name="'key_' + index + 1" :id="'key_' + index + 1" x-model="fields[index].key" class="border p-2"></span>
                            </div>
                            <div>
                                <label :for="'type_' + index + 1" class="block">Resource type</label>
                                <select :name="'type_' + index + 1" :id="'type_' + index + 1" x-model="fields[index].type" class="border p-2">
                                    <option value="string">String</option>
                                    <option value="boolean">Boolean</option>
                                    <option value="number">Number</option>
                                    <option value="select">Select</option>
                                    <option value="money">Money</option>
                                </select>
                            </div>
                        </fieldset>
                    </li>
                </template>
            </ul>
            <button type="button" @click="fields.push({})" class="p-2 bg-slate-100">Add Field</button>
        </form>
    </section>
    <section>
        <div class="grid grid-cols-1 gap-2">
            <h2 class="text-xl font-bold">Output</h2>
            <div>
                <h3 class="text-lg font-bold">Fields</h3>
                <ul class="list-decimal pl-4">
                    <template x-for="(field, index) in fields">
                        <li class="mt-2">
                            <span x-text="field.namespace"></span>
                            <span class="text-slate-300">.</span>
                            <span x-text="field.key"></span>
                            <span x-text="field.type" class="text-slate-300 italic capitalize"></span>
                        </li>
                    </template>
                </ul>
            </div>
            <div>
                <h3 class="text-lg font-bold">Link</h3>
                <textarea name="finalURL" id="finalURL" rows="4" x-model="finalURL" class="break-all w-full" onclick="this.select();" readonly></textarea>
            </div>
        </div>
    </section>
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('meta', () => ({
                shop: 'example.myshopify.com',
                resource: 'Product',
                fields: [
                    {
                        "namespace": "descriptors",
                        "key": "short",
                        "type": "string"
                    }
                ],
                get finalURL() { 
                    let fieldsString = this.fields.map(field => {
                        if (!(field.namespace && field.key && field.type)) {
                            return
                        }
                        return `metafields.${field.namespace}.${field.key}:${field.type}`
                    })
                    let url = `https://${this.shop}/admin/bulk?edit=title%2C${encodeURIComponent(fieldsString)}&resource_name=${this.resource}`
                    return url
                },
            }))
        })
    </script>
</body>
</html>